window.FB||(window.FB={});GrunionFB_i18n=jQuery.extend({nameLabel:"Name",emailLabel:"Email",urlLabel:"Website",commentLabel:"Comment",newLabel:"New Field",optionsLabel:"Options",optionLabel:"Option",firstOptionLabel:"First option",problemGeneratingForm:"Oops, there was a problem generating your form.  You'll likely need to try again.",moveInstructions:"Drag up or down\nto re-arrange",moveLabel:"move",editLabel:"edit",savedMessage:"Saved successfully",requiredLabel:"(required)",exitConfirmMessage:"Are you sure you want to exit the form editor without saving?  Any changes you have made will be lost."},GrunionFB_i18n);GrunionFB_i18n.moveInstructions=GrunionFB_i18n.moveInstructions.replace("\n","<br />");FB.ContactForm=function(){function j(){try{d++;if(d<=e){jQuery("#fb-extra-fields").append('<div id="fb-new-field'+d+'" fieldid="'+d+'" class="fb-new-fields"><div class="fb-fields"><div id="'+d+'" class="fb-remove"></div><label fieldid="'+d+'" for="fb-field'+d+'"><span class="label-text">'+GrunionFB_i18n.newLabel+'</span> </label><input type="text" id="fb-field'+d+'" disabled="disabled" /></div></div>');a.fields[d]={label:GrunionFB_i18n.newLabel,type:"text",required:!1,options:[],order:"5"};d===e&&jQuery("#fb-new-field").hide();g=0;f={};jQuery("#fb-new-options").html('<label for="fb-option0">'+GrunionFB_i18n.optionsLabel+'</label><input type="text" id="fb-option0" optionid="0" value="'+GrunionFB_i18n.firstOptionLabel+'" class="fb-options" />');jQuery("#fb-options").hide();jQuery("#fb-new-label").val(GrunionFB_i18n.newLabel);jQuery("#fb-new-type").val("text");jQuery("#fb-field-id").val(d);setTimeout(function(){jQuery("#fb-new-label").focus().select()},100)}else jQuery("#fb-new-field").hide()}catch(b){c&&console.log("addField(): "+b)}}function k(){try{g++;var b=jQuery("#fb-field-id").val(),d=jQuery("#fb-new-type").val();if(d==="radio"){jQuery("#fb-new-options").append('<div id="fb-option-box-'+g+'" class="fb-new-fields"><span optionid="'+g+'" class="fb-remove-option"></span><label></label><input type="text" id="fb-option'+g+'" optionid="'+g+'" value="'+GrunionFB_i18n.optionLabel+'" class="fb-options" /><div>');jQuery("#fb-new-field"+b+" .fb-fields").append('<div id="fb-radio-'+b+"-"+g+'"><input type="radio" disabled="disabled" id="fb-field'+b+'" name="radio-'+b+'" /><span>'+GrunionFB_i18n.optionLabel+'</span><div class="clear"></div></div>')}else{jQuery("#fb-new-options").append('<div id="fb-option-box-'+g+'" class="fb-new-fields"><span optionid="'+g+'" class="fb-remove-option"></span><label></label><input type="text" id="fb-option'+g+'" optionid="'+g+'" value="" class="fb-options" /><div>');jQuery("#fb-field"+b).append('<option id="fb-'+b+"-"+g+'" value="'+b+"-"+g+'"></option>')}a.fields[b].options[g]="";jQuery("#fb-option"+g).focus().select()}catch(e){c&&console.log("addOption(): "+e)}}function l(){try{a.to&&jQuery("#fb-field-my-email").val(a.to);a.subject&&jQuery("#fb-field-subject").val(a.subject);jQuery.each(a.fields,function(a,b){jQuery("#fb-extra-fields").before('<div class="fb-new-fields ui-state-default" fieldid="'+a+'" id="fb-new-field'+a+'"><div class="fb-fields"></div></div>');jQuery("#fb-field-id").val(a);f[a]={};f[a].options=[];(b.type==="radio"||b.type==="select")&&jQuery.each(b.options,function(b,c){f[a].options[b]=c});G(b.type,b.label,b.required)})}catch(b){c&&console.log("buildPreview(): "+b)}}function m(a,b){try{var d="";for(i=0;i<f[a].options.length;i++)f[a].options[i]!==undefined&&(b==="radio"?d=d+'<div id="fb-radio-'+a+"-"+i+'"><input type="radio" id="fb-field'+a+'" name="radio-'+a+'" /><span>'+f[a].options[i]+'</span><div class="clear"></div></div>':d=d+'<option id="fb-'+a+"-"+i+'" value="'+a+"-"+i+'">'+f[a].options[i]+"</option>");return d}catch(e){c&&console.log("customOptions(): "+e)}}function n(b){try{d--;var f=b.attr("id");delete a.fields[f];jQuery("#"+f).parent().parent().remove();d<=e&&jQuery("#fb-new-field").show()}catch(g){c&&console.log("deleteField(): "+g)}}function o(a){try{scroll(0,0);setTimeout(function(){jQuery("#fb-new-label").focus().select()},100);var b=a.parent().attr("fieldid");t(b)}catch(d){c&&console.log("editField(): "+d)}}function p(){try{jQuery.post(ajaxurl,a,function(a){h=a})}catch(b){alert(GrunionFB_i18n.problemGeneratingForm);c&&console.log("grabShortcode(): "+b)}}function q(){jQuery("#fb-desc").hide();jQuery("#fb-add-field").show()}function r(){try{jQuery("#TB_imageOff",window.parent.document).unbind("click");jQuery("#TB_closeWindowButton",window.parent.document).unbind("click");jQuery("#TB_window",window.parent.document).fadeOut("fast");jQuery("#TB_window,#TB_overlay,#TB_HideSelect",window.parent.document).trigger("unload").unbind().remove();jQuery("#TB_load",window.parent.document).remove();if(typeof window.parent.document.body.style.maxHeight=="undefined"){jQuery("body","html",window.parent.document).css({height:"auto",width:"auto"});jQuery("html",window.parent.document).css("overflow","")}window.parent.document.onkeydown="";window.parent.document.onkeyup="";return!1}catch(a){c&&console.log("hidePopup(): "+a)}}function s(a,b){try{if(a==="show"){jQuery(".fb-edit-field").is(":visible")&&jQuery(".fb-edit-field").remove();b.find("label").prepend('<span class="right fb-edit-field" style="font-weight: normal;"><a href="" class="fb-reorder"><div style="display: none;">'+GrunionFB_i18n.moveInstructions+"</div>"+GrunionFB_i18n.moveLabel+'</a>&nbsp;&nbsp;<span style="color: #C7D8DE;">|</span>&nbsp;&nbsp;<a href="" class="fb-edit">'+GrunionFB_i18n.editLabel+"</a></span>")}else jQuery(".fb-edit-field").remove()}catch(d){c&&console.log("hideShowEditLink(): "+d)}}function t(b){try{var d=a.fields[b].type;jQuery("#fb-options").hide();jQuery("#fb-field-id").val(b);jQuery("#fb-new-label").val(a.fields[b].label);jQuery("#fb-new-type").val(a.fields[b].type);a.fields[b].required?jQuery("#fb-new-required").prop("checked",!0):jQuery("#fb-new-required").prop("checked",!1);if(d==="select"||d==="radio"){var e="",f=a.fields[b].options;jQuery("#fb-options").show();jQuery("#fb-new-options").html("");for(i=0;i<f.length;i++)f[i]!==undefined&&(d==="radio"?jQuery("#fb-new-options").append('<div id="fb-option-box-'+i+'" class="fb-new-fields"><span optionid="'+i+'" class="fb-remove-option"></span><label></label><input type="text" id="fb-option'+i+'" optionid="'+i+'" value="'+a.fields[b].options[i]+'" class="fb-options" /><div>'):jQuery("#fb-new-options").append('<div id="fb-option-box-'+i+'" class="fb-new-fields"><span optionid="'+i+'" class="fb-remove-option"></span><label></label><input type="text" id="fb-option'+i+'" optionid="'+i+'" value="'+a.fields[b].options[i]+'" class="fb-options" /><div>'))}q()}catch(g){c&&console.log("loadFieldEditor(): "+g)}}function u(d){try{a.fields={};if(!d)a.fields=b;else{jQuery.each(d.fields,function(b,c){a.fields[b]=c});a.to=d.to;a.subject=d.subject}}catch(e){c&&console.log("parseShortcode(): "+e)}}function v(b){try{var d=jQuery("#fb-field-id").val(),e=jQuery("#fb-option"+b).val(),f=jQuery("#fb-new-type").val();jQuery("#fb-option-box-"+b).remove();f==="radio"?jQuery("#fb-radio-"+d+"-"+b).remove():jQuery("#fb-"+d+"-"+b).remove();var g=a.fields[d].options.indexOf(e);g!==-1&&a.fields[d].options.splice(g,1)}catch(h){c&&console.log("removeOption(): "+h)}}function w(){try{var b=jQuery("#fb-field-id").val();jQuery("#fb-options").hide();f[b]===undefined&&(f[b]={});f[b].options=a.fields[b].options;a.fields[b].options=[]}catch(d){c&&console.log("removeOptions(): "+d)}}function x(){try{jQuery("div#sortable div.fb-new-fields").each(function(b){var c=jQuery(this).attr("fieldid");a.fields[c].order=b});jQuery.post(ajaxurl,a,function(a){var b=jQuery("#edButtonPreview",window.parent.document).hasClass("active");b||(b=jQuery("#wp-content-wrap",window.parent.document).hasClass("tmce-active"));var c=window.dialogArguments||opener||parent||top;if(b)var d=c.tinyMCE.activeEditor.getContent();else{var d=jQuery("#editorcontainer textarea",window.parent.document).val();typeof d!="string"&&(d=jQuery(".wp-editor-area",window.parent.document).val())}var e=new RegExp("\\[contact-form\\b.*?\\/?\\](?:[\\s\\S]+?\\[\\/contact-form\\])?");a=a.replace(/\n/g," ");d.match(e)?b?c.tinyMCE.activeEditor.execCommand("mceSetContent",!1,d.replace(e,a)):jQuery("#content",window.parent.document).val(d.replace(e,a)):b?c.tinyMCE.activeEditor.execCommand("mceInsertContent",!1,a):jQuery("#content",window.parent.document).val(d+a);r()})}catch(b){c&&console.log("sendShortcodeToEditor(): "+b)}}function y(){jQuery("#fb-desc").show();jQuery("#fb-add-field").hide()}function z(a){try{var b=a?a:GrunionFB_i18n.savedMessage;jQuery("#fb-success").html(b);jQuery("#fb-success").slideDown("fast");setTimeout(function(){jQuery("#fb-success").slideUp("fast")},2500)}catch(d){c&&console.log("showAndHideMessage(): "+d)}}function A(a){try{if(a==="preview"){jQuery("#tab-preview a").addClass("current");jQuery("#tab-settings a").removeClass("current");jQuery("#fb-preview-form, #fb-desc").show();jQuery("#fb-email-settings, #fb-email-desc").hide()}else{jQuery("#tab-preview a").removeClass("current");jQuery("#tab-settings a").addClass("current");jQuery("#fb-preview-form, #fb-desc, #fb-add-field").hide();jQuery("#fb-email-settings, #fb-email-desc").show();jQuery("#fb-field-my-email").focus().select()}}catch(b){c&&console.log("switchTabs(): "+b)}}function B(){try{var b=jQuery("#fb-field-id").val(),d=jQuery("#fb-new-label").val();d.length===0?jQuery("#fb-new-field"+b+" label .label-text").html("New field"):jQuery("#fb-new-field"+b+" label .label-text").html(d);a.fields[b].label=d}catch(e){c&&console.log("updateLabel(): "+e)}}function C(){try{var b=jQuery("#fb-field-my-email").val();a.to=b}catch(d){c&&console.log("updateMyEmail(): "+d)}}function D(b){try{var d=jQuery("#fb-field-id").val(),e=b.attr("optionid"),f=b.val(),g=jQuery("#fb-new-type").val();g==="radio"?jQuery("#fb-radio-"+d+"-"+e+" span").html(f):jQuery("#fb-"+d+"-"+e).text(f);a.fields[d].options[e]=f}catch(h){c&&console.log("updateOption(): "+h)}}function E(){try{var b=jQuery("#fb-field-id").val(),d=jQuery("#fb-new-required").is(":checked");if(d){a.fields[b].required=!0;jQuery("#fb-new-field"+b+" label").append('<span class="label-required">'+GrunionFB_i18n.requiredLabel+"</span>")}else{a.fields[b].required=!1;jQuery("#fb-new-field"+b+" label .label-required").remove()}}catch(e){c&&console.log("updateRequired(): "+e)}}function F(){try{var b=jQuery("#fb-field-subject").val();a.subject=b}catch(d){c&&console.log("updateSubject(): "+d)}}function G(b,d,e){try{var h=b,i=jQuery("#fb-field-id").val();if(!b)var b=jQuery("#fb-new-type").val();if(!d)var d=jQuery("#fb-new-field"+i+" label").html();var j=e?'<span class="label-required">'+GrunionFB_i18n.requiredLabel+"</span>":"",k='<label fieldid="'+i+'" for="fb-field'+i+'"><span class="label-text">'+d+"</span>"+j+"</label>",l='<input type="radio" name="radio-'+i+'" id="fb-field'+i+' "disabled="disabled" />',n='<label fieldid="'+i+'" for="fb-field'+i+'" class="fb-radio-label"><span class="label-text">'+d+"</span>"+j+"</label>",o='<div class="fb-remove fb-remove-small" id="'+i+'"></div>',p='<div class="fb-remove" id="'+i+'"></div>',q='<input type="checkbox" id="fb-field'+i+'" "disabled="disabled" />',r='<input type="text" id="fb-field'+i+'" "disabled="disabled" />',s='<textarea id="fb-field'+i+'" "disabled="disabled"></textarea>',t='<div class="clear"></div>',u='<select id="fb-field'+i+'" fieldid="'+i+'"><option id="fb-'+i+"-"+g+'" value="'+i+"-"+g+'">'+GrunionFB_i18n.firstOptionLabel+"</option></select>";switch(b){case"checkbox":w();jQuery("#fb-new-field"+i+" .fb-fields").html(o+q+n+t);break;case"email":w();jQuery("#fb-new-field"+i+" .fb-fields").html(p+k+r);break;case"name":w();jQuery("#fb-new-field"+i+" .fb-fields").html(p+k+r);break;case"radio":jQuery("#fb-new-field"+i+" .fb-fields").html(k+o+'<div fieldid="'+i+'" id="fb-custom-radio'+i+'"></div>');if(f[i]!==undefined&&f[i].options.length!==0){a.fields[i].options=f[i].options;jQuery("#fb-custom-radio"+i).append(m(i,b))}else{jQuery("#fb-new-options").html('<label for="fb-option0">'+GrunionFB_i18n.optionsLabel+'</label><input type="text" id="fb-option0" optionid="0" value="'+GrunionFB_i18n.firstOptionLabel+'" class="fb-options" />');jQuery("#fb-custom-radio"+i).append('<div id="fb-radio-'+i+'-0">'+l+"<span>"+GrunionFB_i18n.firstOptionLabel+"</span>"+t+"</div>");a.fields[i].options[g]=GrunionFB_i18n.firstOptionLabel}jQuery("#fb-options").show();setTimeout(function(){jQuery("#fb-option0").focus().select()},100);break;case"select":jQuery("#fb-new-field"+i+" .fb-fields").html(p+k+u);if(f[i]!==undefined&&f[i].options.length!==0){a.fields[i].options=f[i].options;jQuery("#fb-field"+i).html(m(i,b))}else{jQuery("#fb-new-options").html('<label for="fb-option0">'+GrunionFB_i18n.optionsLabel+'</label><input type="text" id="fb-option0" optionid="0" value="'+GrunionFB_i18n.firstOptionLabel+'" class="fb-options" />');a.fields[i].options[g]=GrunionFB_i18n.firstOptionLabel}jQuery("#fb-options").show();setTimeout(function(){jQuery("#fb-option0").focus().select()},100);break;case"text":w();jQuery("#fb-new-field"+i+" .fb-fields").html(p+k+r);break;case"textarea":w();jQuery("#fb-new-field"+i+" .fb-fields").html(p+k+s);break;case"url":w();jQuery("#fb-new-field"+i+" .fb-fields").html(p+k+r)}a.fields[i].type=b}catch(v){c&&console.log("updateType(): "+v)}}var a={action:"grunion_shortcode",_ajax_nonce:ajax_nonce_shortcode,to:"",subject:"",fields:{}},b={name:{label:GrunionFB_i18n.nameLabel,type:"name",required:!0,options:[],order:"1"},email:{label:GrunionFB_i18n.emailLabel,type:"email",required:!0,options:[],order:"2"},url:{label:GrunionFB_i18n.urlLabel,type:"url",required:!1,options:[],order:"3"},comment:{label:GrunionFB_i18n.commentLabel,type:"textarea",required:!0,options:[],order:"4"}},c=!1,d=0,e=5,f={},g=0,h;return{resizePop:function(){try{var a=jQuery("body",window.parent.document).width(),b=jQuery("body",window.parent.document).height(),d=typeof document.body.style.maxHeight=="undefined";jQuery("#TB_window, #TB_iframeContent",window.parent.document).css("width","768px");jQuery("#TB_window",window.parent.document).css({left:(a-768)/2+"px",top:"23px",position:"absolute",marginLeft:"0"});d||jQuery("#TB_window, #TB_iframeContent",window.parent.document).css("height",b-73+"px")}catch(e){c&&console.log("resizePop(): "+e)}},init:function(){window.parent.scroll(0,0);if(jQuery("#edButtonPreview",window.parent.document).hasClass("active")||jQuery("#wp-content-wrap",window.parent.document).hasClass("tmce-active"))var a=window.dialogArguments||opener||parent||top,b=a.tinyMCE.activeEditor.getContent();else var b=jQuery("#content",window.parent.document).val();var c={action:"grunion_shortcode_to_json",_ajax_nonce:ajax_nonce_json,post_id:postId,content:b};jQuery.post(ajaxurl,c,function(a){u(jQuery.parseJSON(a));l()});jQuery(".fb-add-field").click(function(){j();q();return!1});jQuery("#fb-new-label").keyup(function(){B()});jQuery("#fb-new-type").change(function(){G()});jQuery("#fb-new-required").click(function(){E()});jQuery(".fb-remove").live("click",function(){y();n(jQuery(this));p()});jQuery("#fb-preview").submit(function(){x();return!1});jQuery("#TB_overlay, #TB_closeWindowButton",window.parent.document).mousedown(function(){confirm(GrunionFB_i18n.exitConfirmMessage)&&r()});jQuery("#fb-another-option").live("click",function(){k()});jQuery(".fb-options").live("keyup",function(){D(jQuery(this))});jQuery(".fb-remove-option").live("click",function(){v(jQuery(this).attr("optionid"))});jQuery("#tab-preview a").click(function(){A("preview");return!1});jQuery("#fb-prev-form").click(function(){A("preview");z(GrunionFB_i18n.savedMessage);return!1});jQuery("#tab-settings a").click(function(){A();return!1});jQuery("#fb-field-my-email").blur(function(){C()});jQuery("#fb-field-subject").blur(function(){F()});jQuery(".fb-form-case .fb-new-fields").live("mouseenter",function(){s("show",jQuery(this))});jQuery(".fb-form-case .fb-new-fields").live("mouseleave",function(){s("hide");return!1});jQuery(".fb-edit-field").live("click",function(){o(jQuery(this));return!1});jQuery(".fb-edit-field .fb-reorder").live("click",function(){return!1});jQuery("#fb-save-field").live("click",function(){y();z();return!1});jQuery("#fb-feedback").click(function(){var a=jQuery(this).attr("href");window.parent.location=a;return!1});jQuery("#sortable").sortable({axis:"y",handle:".fb-reorder",revert:!0,start:function(){jQuery(".fb-edit-field").hide()}});jQuery("#draggable").draggable({axis:"y",handle:".fb-reorder",connectToSortable:"#sortable",helper:"clone",revert:"invalid"})}}}();